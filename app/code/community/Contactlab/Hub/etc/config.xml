<?xml version="1.0"?>
<config>
    <modules>
        <Contactlab_Hub>
            <version>0.1.0</version>
        </Contactlab_Hub>
    </modules>
    <global>
    	<models>
            <contactlab_hub>
                <class>Contactlab_Hub_Model</class>
                <resourceModel>contactlab_hub_resource</resourceModel>
            </contactlab_hub>
            <contactlab_hub_resource>
            	<class>Contactlab_Hub_Model_Resource</class>
                <deprecatedNode>contactlab_hub_mysql4</deprecatedNode>
                <entities>
                    <event>
                        <table>contactlab_hub_event</table>
                    </event>
                    <previouscustomers>
                    	<table>contactlab_hub_previouscustomers</table>
                    </previouscustomers> 
                    <abandoned_carts>
                    	<table>contactlab_hub_abandoned_carts</table>
                    </abandoned_carts>                    
                </entities>
            </contactlab_hub_resource>
            <contactlab_hub_eventhub>
                <class>Contactlab_Hub_Model_Eventhub</class>
            </contactlab_hub_eventhub>
            <contactlab_hub_eventhub>
                <class>Contactlab_Hub_Model_Eventhub</class>
            </contactlab_hub_eventhub>
            <!--  
            <core>
				<rewrite>
					<email>Contactlab_Hub_Model_Email</email>
					<email_template>Contactlab_Hub_Model_Email_Template</email_template>
                    <email_queue>Contactlab_Hub_Model_Email_Queue</email_queue>
				</rewrite>
			</core>
			-->
        </models>
        <resources>
            <contactlab_hub_setup>
                <setup>
                    <module>Contactlab_Hub</module>
                    <class>Mage_Customer_Model_Entity_Setup</class>
                </setup>
  			</contactlab_hub_setup>
        </resources>
	    <helpers>
	    	<contactlab_hub>
	    		<class>Contactlab_Hub_Helper</class>
	    	</contactlab_hub>
	    </helpers>
        <blocks>
            <contactlab_hub>
                <class>Contactlab_Hub_Block</class>
            </contactlab_hub>
        </blocks> 	
     	<events>
            <!-- CUSTOMER EVENTS -->
            <customer_login>
                <observers>
                    <contactlab_hub>
                        <type>singleton</type>
                        <class>contactlab_hub/observer</class>
                        <method>traceCustomerLogin</method>
                    </contactlab_hub>
                </observers>
            </customer_login>
            <customer_logout>
                <observers>
                    <contactlab_hub>
                        <type>singleton</type>
                        <class>contactlab_hub/observer</class>
                        <method>traceCustomerLogout</method>
                    </contactlab_hub>
                </observers>
            </customer_logout>
            <customer_register_success>
                <observers>
                    <contactlab_hub>
                        <type>singleton</type>
                        <class>contactlab_hub/observer</class>
                        <method>traceCustomerRegister</method>
                    </contactlab_hub>
                </observers>
            </customer_register_success>
            <newsletter_subscriber_save_before>
                <observers>
                    <contactlab_hub>
                        <type>singleton</type>
                        <class>contactlab_hub/observer</class>
                        <method>traceSubscriptionSave</method>
                    </contactlab_hub>
                </observers>
            </newsletter_subscriber_save_before>            		
			<controller_action_predispatch_newsletter_manage_index>
				<observers>
	                <contactlab_hub_check_subscription>
	                    <type>singleton</type>
	                    <class>contactlab_hub/observer</class>
	                    <method>checkSubscription</method>
	                </contactlab_hub_check_subscription>
	            </observers>
			</controller_action_predispatch_newsletter_manage_index>




            <!-- PRODUCT EVENTS -->
			<catalog_product_compare_add_product>
            	<observers>
                    <contactlab_hub>
     					<type>singleton</type>
     					<class>contactlab_hub/observer</class>
                        <method>traceCompareAddEvent</method>
                    </contactlab_hub>
                </observers>
            </catalog_product_compare_add_product>
            <catalog_product_compare_remove_product>
            	<observers>
                    <contactlab_hub>
     					<type>singleton</type>
     					<class>contactlab_hub/observer</class>
                        <method>traceCompareRemoveEvent</method>
                    </contactlab_hub>
                </observers>
            </catalog_product_compare_remove_product>
            <wishlist_add_item>
                <observers>
                    <contactlab_hub>
                        <type>singleton</type>
                        <class>contactlab_hub/observer</class>
                        <method>traceWishlistAddEvent</method>
                    </contactlab_hub>
                </observers>
            </wishlist_add_item>
            <wishlist_add_product>
                <observers>
                    <contactlab_hub>
     					<type>singleton</type>
     					<class>contactlab_hub/observer</class>
                        <method>traceWishlistAddEvent</method>
                    </contactlab_hub>
                </observers>
            </wishlist_add_product>
			<wishlist_item_delete_before>
            	<observers>
                    <contactlab_hub>
     					<type>singleton</type>
     					<class>contactlab_hub/observer</class>
                        <method>traceWishlistRemoveEvent</method>
                    </contactlab_hub>
                </observers>
            </wishlist_item_delete_before>


            <checkout_submit_all_after>
                <observers>
                    <contactlab_hub>
                        <type>singleton</type>
                        <class>contactlab_hub/observer</class>
                        <method>traceCheckoutEvent</method>
                    </contactlab_hub>
                </observers>
            </checkout_submit_all_after>
            <checkout_cart_product_add_after>
                <observers>
                    <contactlab_hub>
     					<type>singleton</type>
     					<class>contactlab_hub/observer</class>
                        <method>traceCartAddEvent</method>
                    </contactlab_hub>
                </observers>
            </checkout_cart_product_add_after>
            <sales_quote_remove_item>
            	<observers>
                    <contactlab_hub>
     					<type>singleton</type>
     					<class>contactlab_hub/observer</class>
                        <method>traceQuoteRemoveEvent</method>
                    </contactlab_hub>
                </observers>
            </sales_quote_remove_item>
            
            <sales_order_shipment_save_after>
            	<observers>
                    <contactlab_hub>
     					<type>singleton</type>
     					<class>contactlab_hub/observer</class>
                        <method>traceShipmentEvent</method>
                    </contactlab_hub>
                </observers>
            </sales_order_shipment_save_after>
            
            
            <!-- checkout_onepage_controller_success_action>
                <observers>
                    <contactlab_hub>
                        <type>singleton</type>
                        <class>contactlab_hub/observer</class>
                        <method>traceGenericEvent</method>
                    </contactlab_hub>
                </observers>
            </checkout_onepage_controller_success_action -->
     		<!-- checkout_cart_update_items_after>
     			<observers>
                    <contactlab_hub>
     					<type>singleton</type>
     					<class>contactlab_hub/observer</class>
                        <method>traceCartUpdateEvent</method>
                    </contactlab_hub>
                </observers>
     		</checkout_cart_update_items_after -->
            
            
            <!-- wishlist_product_add_after>
                <observers>
                    <contactlab_hub>
     					<type>singleton</type>
     					<class>contactlab_hub/observer</class>
                        <method>traceGenericEvent</method>
                    </contactlab_hub>
                </observers>
            </wishlist_product_add_after -->
            
            <!-- catalog_category_collection_load_after>
                <observers>
                    <contactlab_hub>
                        <type>singleton</type>
                        <class>contactlab_hub/observer</class>
                        <method>traceGenericEvent</method>
                    </contactlab_hub>
                </observers>
            </catalog_category_collection_load_after -->



     	</events>
     
    </global>
    <frontend>    	
    	<events>
    		<!-- 
	        <controller_action_layout_render_before_catalogsearch_result_index>
	            <observers>
	                <contactlab_hub>
	                    <type>singleton</type>
	                    <class>contactlab_hub/observer</class>
	                    <method>traceSearchResult</method>
	                </contactlab_hub>
	            </observers>
	        </controller_action_layout_render_before_catalogsearch_result_index>
		 	-->
	        <controller_action_predispatch>
	            <observers>
	                <contactlab_hub>
	                    <type>singleton</type>
	                    <class>contactlab_hub/observer</class>
	                    <method>traceChangeStoreEvent</method>
	                </contactlab_hub>
	            </observers>
	        </controller_action_predispatch>
	        <controller_action_layout_generate_blocks_after>
	            <observers>
	                <contactlab_hub_place_tracking>
	                    <type>singleton</type>
	                    <class>contactlab_hub/observer</class>
	                    <method>placeHubTracking</method>
	                </contactlab_hub_place_tracking>
	            </observers>
	        </controller_action_layout_generate_blocks_after>	       
        </events>
        <layout>
            <updates>
                <contactlab_layout>
                    <file>contactlab/layout.xml</file>
                </contactlab_layout>
            </updates>
        </layout>
	</frontend>
	<admin>
        <routers>
            <adminhtml>
                <args>
                    <modules>
                        <contactlab_hub before="Mage_Adminhtml">Contactlab_Hub_Adminhtml</contactlab_hub>
                    </modules>
                </args>
            </adminhtml>
        </routers>
    </admin>
	<adminhtml>
		<layout>
            <updates>
                <contactlab_subscribers>
                    <file>contactlab/hub.xml</file>
                </contactlab_subscribers>
            </updates>
        </layout>
        <translate>
            <modules>
                <contactlab_subscribers>
                    <files>
                        <default>contactlab/Contactlab_Hub.csv</default>
                    </files>
                </contactlab_subscribers>
            </modules>
        </translate>
		<events>
			<admin_system_config_changed_section_contactlab_hub_options>
			    <observers>
			        <contactlab_hub>
			            <type>singleton</type>
			            <class>contactlab_hub/observer</class>
	                    <method>setEnabledFrom</method>
			        </contactlab_hub>
			    </observers>
			</admin_system_config_changed_section_contactlab_hub_options>
		</events>
	</adminhtml>
    <default>
        <contactlab_hub>
            <settings>
                <apitoken>YOUR_TOKEN_HERE</apitoken>
                <apiurl>https://api.contactlab.it</apiurl>
                <apiworkspaceid>YOUR_WORKSPACE_HERE</apiworkspaceid>
                <apinodeid>YOUR_NODE_HERE</apinodeid>
                <apicontext>ECOMMERCE</apicontext>
                <useproxy>0</useproxy>
                <apiproxy></apiproxy>
                <debug>0</debug>
                <simulatehub>0</simulatehub>
                <buffer>1</buffer>
                <log>0</log>
                <logfilename>contactlabhub.log</logfilename>
            </settings>
            <events>
            	<!-- 
                <evtgeneric_eventname>genericActiveEvent</evtgeneric_eventname>
                <evtregister>1</evtregister>                
                <evtregister_eventname>formCompiled</evtregister_eventname>
                <evtlogin>1</evtlogin>
                <evtlogin_eventname>loggedIn</evtlogin_eventname>
                <evtlogout>1</evtlogout>
                <evtlogout_eventname>loggedOut</evtlogout_eventname>
                <evtsub_on>1</evtsub_on>                
                <evtsub_on_eventname>campaignSubscribed</evtsub_on_eventname>
                <evtsub_off>1</evtsub_off>                
                <evtsub_off_eventname>campaignUnsubscribed</evtsub_off_eventname>
                <evtlocale>1</evtlocale>
                <evtlocale_eventname>changedSetting</evtlocale_eventname>
                <evtcheckout>1</evtcheckout>
                <evtcheckout_eventname>completedOrder</evtcheckout_eventname>
                <evtsearch>1</evtsearch>
                <evtsearch_eventname>searched</evtsearch_eventname>
                <evtcart_add>1</evtcart_add>
                <evtcart_add_eventname>addedProduct</evtcart_add_eventname>
                <evtcart_remove>1</evtcart_remove>
                <evtcart_remove_eventname>removedProduct</evtcart_remove_eventname>
                <evtwishlist_add>1</evtwishlist_add>
                <evtwishlist_add_eventname>addedWishlist</evtwishlist_add_eventname>
                <evtwishlist_remove>1</evtwishlist_remove>
                <evtwishlist_remove_eventname>removedWishlist</evtwishlist_remove_eventname>
                <evtcompare_add>1</evtcompare_add>
                <evtcompare_add_eventname>addedCompare</evtcompare_add_eventname>
                <evtcompare_remove>1</evtcompare_remove>
                <evtcompare_remove_eventname>removedCompare</evtcompare_remove_eventname>
                <evtview>1</evtview>
                <evtview_eventname>viewedProduct</evtview_eventname>
                 -->                
				<evtregister>1</evtregister>
                <loggedIn>1</loggedIn>
                <loggedOut>1</loggedOut>
                <campaignName>Magento_Campaign</campaignName>
               	<campaignSubscribed>1</campaignSubscribed>
                <campaignUnsubscribed>1</campaignUnsubscribed>
                <changedSetting>1</changedSetting>
               	<completedOrder>1</completedOrder>
                <searched>1</searched>
                <addedProduct>1</addedProduct>
                <removedProduct>1</removedProduct>
                <abandonedCart>1</abandonedCart >
                <send_to_not_subscribed>0</send_to_not_subscribed>
                <min_minutes_from_last_update>120</min_minutes_from_last_update>
                <max_minutes_from_last_update>1440</max_minutes_from_last_update>                           
                <addedWishlist>1</addedWishlist>
                <removedWishlist>1</removedWishlist>
                <addedCompare>1</addedCompare>
                <removedCompare>1</removedCompare>
                <viewedProduct>1</viewedProduct>
                <viewedProductCategory>1</viewedProductCategory>
                <orderShipped>1</orderShipped>                
            </events>      
            <cron_events>
            	<limit>30</limit>
            	<frequency>I</frequency>
            	<repeat_minutes>1</repeat_minutes>
            </cron_events>
            <cron_previous_customers>
            	<limit>50</limit>
            	<frequency>I</frequency>
            	<repeat_minutes>5</repeat_minutes>
            </cron_previous_customers>
        </contactlab_hub>
    </default>

    <crontab>
        <jobs>
        	<contactlab_hub_export_events>
                <description>Export Events To Hub</description>
                <!-- Consume the queue every minute 
                <schedule>                    
                    <cron_expr>* * * * *</cron_expr>
                </schedule>
                -->
                <run>
                    <model>contactlab_hub/cron::exportEvents</model>
                </run>
            </contactlab_hub_export_events>
       		<contactlab_hub_export_previous_customers>
                <description>Export Previous Customers</description>
                <!--
                <schedule>                    
                    <cron_expr>* * * * *</cron_expr>
                </schedule>
                -->
                <run>
                    <model>contactlab_hub/cron::exportPreviousCustomers</model>
                </run>
            </contactlab_hub_export_previous_customers>
            <contactlab_hub_abandoned_carts>
                <description>Export Events To Hub</description>                
                <schedule>                    
                    <cron_expr>* * * * *</cron_expr>
                </schedule>                
                <run>
                    <model>contactlab_hub/cron::getAbandonedCarts</model>
                </run>
            </contactlab_hub_abandoned_carts>
            
            <contactlab_hub_import_subscribers>
                <description>Import Subscribers</description>
                <!--
                <schedule>                    
                    <cron_expr>* * * * *</cron_expr>
                </schedule>
                -->
                <run>
                    <model>contactlab_hub/cron::importSubscribers</model>
                </run>
            </contactlab_hub_import_subscribers>                       
        </jobs>
    </crontab>
</config>